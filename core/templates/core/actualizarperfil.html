{% extends 'partials/base.html' %}

{% load static %}

{% block title %}Actualizar Perfil{% endblock %}

{% block content %}

<section class="section py-5">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <h2 class="mb-5 text-muted">Actualizar Perfil</h2>
        
        <form method="POST" enctype="multipart/form-data">
          {% csrf_token %}
          
          <div class="row">
            <!-- Columna izquierda - Foto de perfil -->
            <div class="col-lg-3">
              <div class="text-center mb-4">
                {% if user.foto_perfil %}
                  <img src="{{ user.foto_perfil.url }}" alt="Foto de perfil" class="img-fluid rounded mb-3" id="preview-image" style="max-width: 200px;">
                {% else %}
                  <img src="{% static 'images/default-avatar.png' %}" alt="Foto por defecto" class="img-fluid rounded mb-3" id="preview-image" style="max-width: 200px;">
                {% endif %}
              </div>
            </div>

            <!-- Columna derecha - Formulario -->
            <div class="col-lg-9">
              <!-- Campo Nombre -->
              <div class="mb-4">
                <label for="nombre" class="form-label text-muted">Nombre</label>
                <input 
                  type="text" 
                  class="form-control form-control-lg" 
                  id="nombre" 
                  name="username" 
                  value="{{ user.username }}"
                  required>
              </div>

              <!-- Campo Correo electrónico -->
              <div class="mb-4">
                <label for="email" class="form-label text-muted">Correo electrónico</label>
                <input 
                  type="email" 
                  class="form-control form-control-lg" 
                  id="email" 
                  name="email" 
                  value="{{ user.email }}"
                  required>
              </div>

              <!-- Campo Foto de perfil -->
              <div class="mb-4">
                <label for="foto" class="form-label text-muted">Foto de perfil</label>
                <input 
                  type="file" 
                  class="form-control form-control-lg" 
                  id="foto" 
                  name="foto_perfil"
                  accept="image/*"
                  onchange="previewImage(event)">
                <div class="form-text">No se eligió ningún archivo</div>
              </div>

              <!-- Botón Guardar -->
              <div class="mb-4">
                <button type="submit" class="btn btn-dark btn-lg px-5">
                  GUARDAR CAMBIOS
                </button>
              </div>
            </div>
          </div>

          <!-- Mensajes de error o éxito -->
          {% if messages %}
            <div class="row mt-3">
              <div class="col-12">
                {% for message in messages %}
                  <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                  </div>
                {% endfor %}
              </div>
            </div>
          {% endif %}
        </form>
      </div>
    </div>
  </div>
</section>

<script>
  // Previsualizar imagen antes de subir
  function previewImage(event) {
    const reader = new FileReader();
    reader.onload = function() {
      const preview = document.getElementById('preview-image');
      preview.src = reader.result;
    }
    reader.readAsDataURL(event.target.files[0]);
    
    // Actualizar texto del archivo seleccionado
    const fileName = event.target.files[0].name;
    event.target.nextElementSibling.textContent = fileName;
  }
</script>

{% endblock content %}